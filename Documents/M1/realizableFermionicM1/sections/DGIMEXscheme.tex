\section{Realizability-Preserving DG-IMEX Scheme}
\label{sec:realizableDGIMEX}

We proceed to develop realizability-preserving DG schemes for the two-moment model based on the IMEX schemes discussed in the previous section (cf. Eqs.~\eqref{imexStages}-\eqref{eq:imexCorrection}).  
Following the framework in \cite{zhangShu_2010b} for high-order DG schemes, the realizability-preserving DG-IMEX scheme is designed to preserve realizability of cell averages over a time step $\dt$ in each element $\bK$.  
Realizability of the cell average is leveraged to limit the polynomial approximation $\vect{\cM}_{h}$ in the stages of the IMEX scheme.  
If the polynomial approximation $\vect{\cM}_{h}$ is not realizable in a finite number of points in $\bK$, the high-order components are damped (see Section~\ref{sec:limiter}).  
The main result of this section is stated in Theorem~\ref{the:realizableDGIMEX}.  

The cell average of the moments is defined as
\begin{equation}
  \vect{\cM}_{\bK}
  =\f{1}{|\bK|}\int_{\bK}\vect{\cM}_{h}\,d\bx.  
\end{equation}
Then, with $v=1$ in Eq.~\eqref{eq:semidiscreteDG}, and invoking the form in Eq.~\eqref{eq:imexStagesRewrite}, the stage values for the cell average in the IMEX scheme are given by
\begin{equation}
  \vect{\cM}_{\bK}^{(i)}
  =\sum_{j=0}^{i-1}c_{ij}\,\vect{\cM}_{\bK}^{(ij)}
  +a_{ii}\,\dt\,\f{1}{\tau}\,\big(\,\vect{\eta}-\vect{\cD}\,\vect{\cM}_{\bK}^{(i)}\,\big), \quad i=1,\ldots,s,
  \label{eq:imexStagesCellAverage}
\end{equation}
where $c_{ij}\ge0$, $\sum_{j=0}^{i-1}c_{ij}=1$, and $a_{ii}>0$, and we have defined
\begin{equation}
  \vect{\cM}_{\bK}^{(ij)}
  =\vect{\cM}_{\bK}^{(j)}-\hat{c}_{ij}\,\dt\,\big\langle\,\nabla\cdot\vect{\cF}(\vect{\cM}_{h}^{(j)})\,\big\rangle_{\bK},
\end{equation}
with $\cM_{\bK}^{(0)}=\cM_{\bK}^{n}$, and where $\hat{c}_{ij}\ge0$.  
The cell average of the divergence operator is (cf. Section~\ref{sec:dg})
\begin{equation}
  \big\langle\,\nabla\cdot\vect{\cF}(\vect{\cM}_{h}^{(j)})\,\big\rangle_{\bK}
  =\f{1}{|\bK|}\sum_{k=1}^{d}\int_{\tilde{\bK}^{k}}
  \big(\,\widehat{\bcF}^{k}(\vect{\cM}_{h}^{(j)})\big|_{\xH^{k}}-\widehat{\bcF}^{k}(\vect{\cM}_{h}^{(j)})\big|_{\xL^{k}}\,\big)\,d\tilde{\vect{x}}^{k}.  
\end{equation}

We first establish conditions for realizability of the stage values in Eq.~\eqref{eq:imexStagesCellAverage}.  
\begin{lemma}
  Let $\vect{\cM}_{\bK}^{(i)}$ satisfy Eq.~\eqref{eq:imexStagesCellAverage}.
  Assume that $\vect{\cM}_{\bK}^{(ij)}\in\cR\,\forall\,i=1,\ldots,s,\,j\le i-1$.  
  Then, $\vect{\cM}_{\bK}^{(i)}\in\cR$, for $i=1,\ldots,s$.  
  \label{lem:imexStagesCellAverage}
\end{lemma}
\begin{proof}
  For $i=1,\ldots,s$, the first term on the right-hand side of Eq.~\eqref{eq:imexStagesCellAverage} constitutes a convex combination of elements in $\cR$; i.e.,
  \begin{equation*}
    \sum_{j=0}^{i-1}c_{ij}\,\vect{\cM}_{\bK}^{(ij)}\in\cR.
  \end{equation*}
  Since $a_{ii}\,\dt/\tau>0$, it follows from Lemma~\ref{lem:implicitStep} that $\vect{\cM}_{\bK}^{(i)}\in\cR$, for $i=1,\ldots,s$.  
\end{proof}

We proceed to establish conditions for which $\vect{\cM}_{\bK}^{(ij)}\in\cR$.  
\begin{lemma}
  Let $\{\beta_{k}\}_{k=1}^{d}$ be a set of positive constants satisfying $\sum_{k=1}^{d}\beta_{k}=1$.  
  If for each $k\in\{1,\ldots,d\}$, 
  \begin{align}
    &\vect{\Gamma}^{k}\big[\vect{\cM}_{h}^{(j)};\hat{c}_{ij}\big](\tilde{\vect{x}}^{k}) \label{eq:realizableGamma} \\
    &:=\f{1}{|K^{k}|}
    \Big[\,\int_{K^{k}}\vect{\cM}_{h}^{(j)}\,dx^{k}-\f{\hat{c}_{ij}\,\dt}{\beta_{k}}\big(\,\widehat{\bcF}^{k}(\vect{\cM}_{h}^{(j)})\big|_{\xH^{k}}-\widehat{\bcF}^{k}(\vect{\cM}_{h}^{(j)})\big|_{\xL^{k}}\,\big)\,\Big]\in\cR, \nonumber    
  \end{align}
  then $\vect{\cM}_{\bK}^{(ij)}\in\cR$.  
  \label{lem:realizableMij}
\end{lemma}
\begin{proof}
  It is easy to show that $\vect{\cM}_{\bK}^{(ij)}$ can be expressed as the convex combination
  \begin{equation}
    \vect{\cM}_{\bK}^{(ij)}
    =\sum_{k=1}^{d}\beta_{k}\,\f{1}{|\tilde{\vect{\bK}}^{k}|}\int_{\tilde{\bK}^{k}}\vect{\Gamma}^{k}\big[\vect{\cM}_{h}^{(j)};\hat{c}_{ij}\big]\,d\tilde{\vect{x}}^{k}.  
    \label{eq:cellAverageInTermsOfGamma}
  \end{equation}
  The result follows immediately.  
\end{proof}
\begin{rem}
  If a quadrature rule $\tilde{\vect{Q}}^{k}\colon C^{0}(\tilde{\bK}^{k})\to\bbR$, with positive weights, and points defined by the set $\tilde{\vect{S}}^{k}$, is used to approximate the integral over $\tilde{\bK}^{k}$ in Eq.~\eqref{eq:cellAverageInTermsOfGamma}, it is sufficient for Eq.~\eqref{eq:realizableGamma} to hold in the quadrature points $\tilde{\vect{S}}^{k}\subset\tilde{\bK}^{k}$.  
\end{rem}

Next, we establish conditions for which Eq.~\eqref{eq:realizableGamma} holds.  
We let $\hat{Q}^{k}\colon C^{0}(K^{k})\to\bbR$ denote the $N$-point \emph{Gauss-Lobatto (GL)} quadrature rule on the interval $K^{k}=(x_{\Low}^{k},x_{\Hgh}^{k})$, with points
\begin{equation}
  \hat{S}^{k}=\left\{x_{\Low}^{k}=\hat{x}_{1}^{k},\ldots,\hat{x}_{N}^{k}=x_{\Hgh}^{k}\right\}, 
  \label{eq:quadraturePointsGL}
\end{equation}
and weights $\hat{w}_{q} \in (0,1]$, normalized so that $\sum_{q=1}^{N} \hat{w}_{q} = 1$.  
(The hat is used to denote the GL rule, which includes the endpoints of the interval $K^{k}$.)
This quadrature integrates polynomials in $x^{k} \in \bbR$ with degree $\le2N-3$ exactly.  
Then, if $\vect{\cM}_{h}^{(j)}$ is represented by such polynomials we have
\begin{equation}
  \int_{K^{k}} \bcM_{h}^{(j)}(x^{k})\,dx^{k} = \hat{Q}^{k}[\bcM_{h}^{(j)}] \equiv
  |K^{k}| \sum_{q=1}^{N} \hat{w}_{q}\,\bcM_{h}^{(j)}(\hat{x}_{q}^{k})
  \label{eq:quadratureRuleGL}
\end{equation}
where, for simplicity of notation, we have suppressed the explicit dependence on $\tilde{\vect{x}}^{k}$ to denote $\bcM_{h}^{(j)}(\hat{x}_q^{k},\tilde{\vect{x}}^{k}) = \bcM_{h}^{(j)}(\hat{x}_{q}^{k})$.  
In each element, we also denote $\vect{\cM}_{h}^{(j)}(\hat{x}_{1}^{k})=\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+})$ and $\vect{\cM}_{h}^{(j)}(\hat{x}_{N}^{k})=\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-})$.  
Similarly, the solution on $\tilde{\vect{\bK}}^{k}$ to the immediate left of $x_{\Low}^{k}$ is denoted $\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-})$, and the solution on $\tilde{\vect{\bK}}^{k}$ to the immediate right of $x_{\Hgh}^{k}$ is denoted $\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+})$.  

With the GL quadrature rule in Eq.~\eqref{eq:quadratureRuleGL} (note $\hat{w}_{1}=\hat{w}_{N}$), we can write $\vect{\Gamma}^{k}$ as the convex combination
\begin{align}
  &\vect{\Gamma}^{k}\big[\bcM_{h}^{(j)};\hat{c}_{ij}\big]
  =\sum_{q=2}^{N-1}\hat{w}_{q}\,\vect{\cM}_{h}^{(j)}(\hat{x}_{q}^{k}) \nonumber \\
  &\hspace{12pt}
  +2\,\hat{w}_{N}\,
  \Phi\big[\,\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+});\hat{c}_{ij}\,\big],
  \label{eq:realizableGammaConvex}
\end{align}
where
\begin{align}
  &\Phi\big[\,\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+});\hat{c}_{ij}\,\big] \nonumber \\
  &=\f{1}{2}\big[\,\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+})+\lambda_{ij}^{k}\,\mathscr{F}\big(\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+})\big)\,\big] \nonumber \\
  &\hspace{12pt}
  +\f{1}{2}\big[\,\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-})-\lambda_{ij}^{k}\,\mathscr{F}\big(\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+})\big)\,\big],
\end{align}
with $\lambda_{ij}^{k}=\hat{c}_{ij}\,\dt/(\beta_{k}\,\hat{w}_{N}\,|K^{k}|)$.  
The following Lemma establishes sufficient conditions for realizability of $\vect{\Gamma}^{k}\big[\bcM_{h}^{(j)};\hat{c}_{ij}\big]$, and hence $\vect{\cM}_{\bK}^{(ij)}$.  
\begin{lemma}
  Assume that $\vect{\cM}_{h}^{(j)}(\hat{x}_{q}^{k})\in\cR$ for all $q=1,\ldots,N$ and all $\bK\in\mathscr{T}$.  
  Let the time step $\dt$ be chosen so that $\lambda_{ij}^{k}\le1$.  
  Let the numerical flux be given by the Lax-Friedrichs flux in Eq.~\eqref{eq:fluxFunctionLF} with $\alpha=1$.  
  Then $\vect{\Gamma}^{k}\big[\bcM_{h}^{(j)};\hat{c}_{ij}\big]\in\cR$.  
  \label{lem:realizableGamma}
\end{lemma}
\begin{proof}
  In Eq.~\eqref{eq:realizableGammaConvex}, $\vect{\Gamma}^{k}\big[\bcM_{h}^{(j)};\hat{c}_{ij}\big]$ is expressed as a convex combination.  
  By assumption, $\vect{\cM}_{h}^{(j)}(\hat{x}_{q}^{k})\in\cR$ ($q=2,\ldots,N-1$).  
  It remains to show 
  \begin{equation*}
    \Phi\big[\,\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+});\hat{c}_{ij}\,\big]\in\cR.  
  \end{equation*}
  Using the Lax-Friedrichs flux in Eq.~\eqref{eq:fluxFunctionLF}, with $\alpha^{k}=1$ ($k=\{1,\ldots,d\}$), it is straightforward to show that
  \begin{align}
    &\Phi\big[\,\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-}),\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+});\hat{c}_{ij}\,\big] \nonumber \\
    &=(1-\lambda_{ij}^{k})\,\big(\,\f{1}{2}\,\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+})+\f{1}{2}\,\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-})\,\big) \nonumber \\
    &\hspace{12pt}
    +\f{1}{2}\,\lambda_{ij}^{k}\,\big(\,\Phi^{+}\big[\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-})\big]+\Phi^{-}\big[\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-})\big]\,\big) \nonumber \\
    &\hspace{12pt}
    +\f{1}{2}\,\lambda_{ij}^{k}\,\big(\,\Phi^{+}\big[\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+})\big]+\Phi^{-}\big[\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+})\big]\,\big),
    \label{eq:phiConvex}
  \end{align}
  where $\Phi^{\pm}(\vect{\cM})=\f{1}{2}\,\big(\vect{\cM}\pm\vect{e}_{k}\cdot\vect{\cF}^{k}(\vect{\cM})\big)$.  
  Since $\lambda_{ij}^{k}\le1$, $\Phi$ is expressed as a convex combination of three terms.  
  By assumption, $\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,-})$, $\vect{\cM}_{h}^{(j)}(x_{\Low}^{k,+})$, $\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,-})$, $\vect{\cM}_{h}^{(j)}(x_{\Hgh}^{k,+})\in\cR$, which immediately implies realizability of the first term on the right-hand side of Eq.~\eqref{eq:phiConvex}.  
  Realizability of the second and third terms follows by invoking Lemma~\ref{lem:explicitStep}.  
  This completes the proof.  
\end{proof}

\begin{rem}
  For the IMEX scheme to be realizability-preserving it is sufficient to set the time step such that
  \begin{equation}
    \dt = c_{\mbox{\tiny Sch}}\,\min_{k} \Big(\, \beta_{k}\,\hat{w}_{N}\,|K^{k}| \,\Big),
    \label{eq:imexTimeStep}
  \end{equation}
  where $c_{\mbox{\tiny Sch}}$ is defined in \eqref{eq:imexCFL}.  
\end{rem}

\begin{rem}
  Lemma~\eqref{lem:realizableGamma} is proven without specification of $\tilde{\vect{x}}^{k}$.  
  In the numerical scheme, we need $\vect{\Gamma}^{k}\big[\bcM_{h}^{(j)};\hat{c}_{ij}\big]$ to be realizable in the quadrature set $\tilde{\vect{S}}^{k}$ used to approximate the integral over $\tilde{\bK}^{k}$ in Eq.~\eqref{eq:realizableGamma}; typically the Legendre-Gauss quadrature points.  
  We thus require $\vect{\cM}_{h}^{(j)}$ to be realizable in the quadrature set $\hat{\vect{S}}^{k}=\tilde{\vect{S}}^{k}\otimes\hat{S}^{k}\subset\bK$, where $\tilde{\vect{S}}^{k}\subset\tilde{\bK}^{k}$, and $\hat{S}^{k}\subset K^{k}$ are the GL quadrature points.  
\end{rem}

\begin{rem}
  Lemmas~\ref{lem:imexStagesCellAverage}, \ref{lem:realizableMij}, and \ref{lem:realizableGamma} establish sufficient conditions for realizability of the cell average of each IMEX stage $\vect{\cM}_{\bK}^{(i)}$, for $i=1,\ldots,s$.  
  Within (and after) each IMEX stage, the realizability-enforcing limiter discussed in Section~\ref{sec:limiter} is invoked to ensure that the numerical solution $\vect{\cM}_{h}^{(i)}(\vect{x})$ is realizable in the quadrature points $\hat{\vect{S}}^{k}$, for $k=1,\ldots,d$.  
\end{rem}

For GSA IMEX schemes, $\tilde{\vect{\cM}}_{\bK}^{n+1}=\vect{\cM}_{\bK}^{(s)}$.  
For IMEX schemes incorporating the correction step in Eq.~\eqref{eq:imexCorrection}, the cell average at $t^{n+1}$ is obtained by solving
\begin{equation}
  \vect{\cM}_{\bK}^{n+1}=\tilde{\vect{\cM}}_{\bK}^{n+1}+\alpha\,\f{\dt^{2}}{\tau^{2}}\,\vect{\cD}\,\big(\,\vect{\eta}-\vect{\cD}\,\vect{\cM}_{\bK}^{n+1}\,\big),
  \label{eq:imexCorrectionCellAverage}
\end{equation}
where $\vect{\eta}$ and $\vect{\cD}$ are defined in Eq.~\eqref{eq:collisionTermMoments}.  
For these IMEX schemes, realizability of $\vect{\cM}_{\bK}^{n+1}$ is established by the following lemma.  
\begin{lemma}
  Suppose that $\tilde{\vect{\cM}}_{\bK}^{n+1}\in\cR$ and $\vect{\cM}_{\bK}^{n+1}$ is obtained by solving Eq.~\eqref{eq:imexCorrectionCellAverage} with $\hat{\alpha}:=\alpha\,\dt^{2}/\tau^{2}\ge0$.  
  Then $\vect{\cM}_{\bK}^{n+1}\in\cR$.  
  \label{lem:imexCorrectionCellAverage}
\end{lemma}
\begin{proof}
  With the collision term in Eq.~\eqref{eq:collisionTermMoments}, Eq.~\eqref{eq:imexCorrectionCellAverage} can be rewritten in the form
  \begin{equation*}
    \vect{\cM}_{\bK}^{n+1}=\tilde{\vect{\cM}}_{\bK}^{n+1}+\hat{\alpha}\,\vect{\cD}\,\vect{\cC}(\vect{\cM}_{\bK}^{n+1}).  
  \end{equation*}
  The proof is completed by invoking Lemma~\ref{lem:correctionStep}.  
\end{proof}

\begin{rem}
  For IMEX scheme PD-ARS (\ref{app:PD-ARS}), which does not invoke the correction step (i.e., $\alpha=0$), $\vect{\cM}_{\bK}^{n+1}=\vect{\cM}_{\bK}^{(s)}$.  
\end{rem}

We are now ready to state the main result of this section.  
\begin{theorem}
  Suppose that
  \begin{itemize}
    \item[1.] For all $k\in\{1,\ldots,d\}$, the Gauss-Lobatto quadrature rule $\hat{Q}^{k}$ is chosen such that Eq.~\eqref{eq:quadratureRuleGL} holds.  
    \item[2.] For all $k\in\{1,\ldots,d\}$ and all $\vect{x}\in\hat{\vect{S}}^{k}$, $\vect{\cM}_{h}^{n}(\vect{x})\in\cR$.
    \item[3.] The time step $\dt$ is chosen such that Eq.~\eqref{eq:imexTimeStep} holds.  
    \item[4.] If $\vect{\cM}_{\bK}^{(i)}\in\cR$, a limiter can be invoked to enforce $\vect{\cM}_{h}^{(i)}(\vect{x})\in\cR$ for all $\vect{x}\in\hat{\vect{S}}^{k}$ and all $k\in\{1,\ldots,d\}$.
  \end{itemize}
  Then $\vect{\cM}_{\bK}^{n+1}\in\cR$.  
  \label{the:realizableDGIMEX}
\end{theorem}
\begin{proof}
  For $i=1$, the cell average $\vect{\cM}_{\bK}^{(1)}$ is obtained by solving (cf. Eq.~\eqref{eq:imexStagesCellAverage})
  \begin{equation*}
    \vect{\cM}_{\bK}^{(1)}=c_{10}\,\vect{\cM}_{\bK}^{(10)}+a_{11}\,\f{\dt}{\tau}\big(\,\vect{\eta}-\vect{\cD}\,\vect{\cM}_{\bK}^{(1)}\,\big),
  \end{equation*}
  where, after invoking the quadrature rule $\tilde{\vect{Q}}^{k}$ to integrate over $\tilde{\bK}^{k}$ in Eq.~\eqref{eq:cellAverageInTermsOfGamma},
  \begin{equation*}
    \vect{\cM}_{\bK}^{(10)}
    =\sum_{k=1}^{d}\f{\beta_{k}}{|\tilde{\bK}^{k}|}\tilde{\vect{Q}}^{k}\big(\vect{\Gamma}^{k}\big[\vect{\cM}_{h}^{n};\hat{c}_{10}\big]\big).  
  \end{equation*}
  Since $\vect{\cM}_{h}^{n}\in\cR$ on $\hat{\vect{S}}^{k}$, for each $k\in\{1,\ldots,d\}$, it follows from Lemma~\ref{lem:realizableGamma} that $\vect{\Gamma}^{k}\big[\vect{\cM}_{h}^{n};\hat{c}_{10}\big]\in\cR$ on $\tilde{\vect{S}}^{k}$.  
  Then, realizability of $\vect{\cM}_{\bK}^{(10)}$ follows from Lemma~\ref{lem:realizableMij}, while $\vect{\cM}_{\bK}^{(1)}\in\cR$ follows by invoking Lemma~\ref{lem:imexStagesCellAverage}.  
  By invoking a realizability-enforcing limiter, $\vect{\cM}_{h}^{(1)}(\vect{x})\in\cR$ for all $\vect{x}\in\hat{\vect{S}}^{k}$ and all $k\in\{1,\ldots,d\}$.  
  Repeated application of these steps give $\vect{\cM}_{\bK}^{(s)}\in\cR$.  
  Since the IMEX scheme is GSA, it follows that $\tilde{\vect{\cM}}_{\bK}^{n+1}\in\cR$.  
  The proof is completed by invoking Lemma~\ref{lem:imexCorrectionCellAverage}.  
\end{proof}