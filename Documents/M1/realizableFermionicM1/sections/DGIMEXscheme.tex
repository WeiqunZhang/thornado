\section{Realizability-Preserving DG-IMEX Scheme}
\label{sec:realizableDGIMEX}

Here we proceed to develop realizability-preserving DG schemes for the two-moment model based on the IMEX schemes discussed in the previous section.  
The realizability-preserving DG scheme is designed to preserve realizability of cell averages over a time step in each element $\bK$.  
The cell average of the moments is defined as
\begin{equation}
  \vect{\cM}_{\bK}
  =\f{1}{|\bK|}\int_{\bK}\vect{\cM}_{h}\,d\bx.  
\end{equation}
Then, with $v=1$ in Eq.~\eqref{eq:semidiscreteDG}, the stage values for the cell average in the IMEX scheme in Eq.~\eqref{eq:imexStagesRewrite} are given by
\begin{equation}
  \vect{\cM}_{\bK}^{(i)}
  =\sum_{j=0}^{i-1}c_{ij}\,\vect{\cM}_{\bK}^{(ij)}
  +a_{ii}\,\dt\,\f{1}{\tau}\,\big(\,\vect{\eta}-\vect{\cD}\,\vect{\cM}_{\bK}^{(i)}\,\big),
  \label{eq:imexStagesCellAverage}
\end{equation}
where we have defined
\begin{equation}
  \vect{\cM}_{\bK}^{(ij)}
  =\vect{\cM}_{\bK}^{(j)}-\hat{c}_{ij}\,\dt\,\big\langle\,\nabla\cdot\vect{\cF}(\vect{\cM}_{h}^{(j)})\,\big\rangle_{\bK},
\end{equation}
with $\cM_{\bK}^{(0)}=\cM_{\bK}^{n}$, and the cell average of the divergence operator is (cf. Section~\ref{sec:dg})
\begin{equation}
  \big\langle\,\nabla\cdot\vect{\cF}(\vect{\cM}_{h})\,\big\rangle_{\bK}
  =\f{1}{|\bK|}\sum_{i=1}^{d}\int_{\tilde{\bK}^{i}}
  \big(\,\widehat{\bcF}^{i}(\vect{\cM}_{h})\big|_{\xH^{i}}-\widehat{\bcF}^{i}(\vect{\cM}_{h})\big|_{\xL^{i}}\,\big)\,d\tilde{\vect{x}}^{i}.  
\end{equation}

\begin{lemma}
  Let $\vect{\cM}_{\bK}^{(i)}$ satisfy Eq.~\eqref{eq:imexStagesCellAverage}.
  Assume that $\vect{\cM}_{\bK}^{n}\in\cR$ and $\vect{\cM}_{\bK}^{(ij)}\in\cR\,\forall\,j\le i-1$.  
  Then, $\vect{\cM}_{\bK}^{(i)}\in\cR$.  
\end{lemma}
\begin{proof}
  The first two terms on the right-hand side of Eq.~\eqref{eq:imexStagesCellAverage} constitute a convex combination of elements in $\cR$; i.e.,
  \begin{equation*}
    c_{i0}\,\vect{\cM}_{\bK}^{n}+\sum_{j=1}^{i-1}c_{ij}\,\vect{\cM}_{\bK}^{(ij)}\in\cR.
  \end{equation*}
  Since $a_{ii}\,\dt/\tau>0$, it follows from Lemma~\ref{lem:implicitStep} that $\vect{\cM}_{\bK}^{(i)}\in\cR$.  
\end{proof}

We proceed to establish conditions for which $\vect{\cM}_{\bK}^{(ij)}\in\cR$.  
To this end, to simplify notation, we consider the moments
\begin{equation}
  \vect{\cM}_{\bK}^{*}
  =\vect{\cM}_{\bK}-\hat{c}\,\dt\,\big\langle\,\nabla\cdot\vect{\cF}(\vect{\cM}_{h})\,\big\rangle_{\bK},
\end{equation}
where $\vect{\cM}_{\bK}$ is the cell average of $\vect{\cM}_{h}\in\bbV^{k}$ and $\hat{c}\ge0$.  
\begin{lemma}
  Let $\{s_{i}\}_{i=1}^{d}$ be a set of positive constants satisfying $\sum_{i=1}^{d}s_{i}=1$.  
  If for each $i\in\{1,\ldots,d\}$, 
  \begin{equation}
    \vect{\Gamma}^{i}\big[\vect{\cM}_{h}\big](\tilde{\vect{x}}^{i})
    :=\f{1}{|K^{i}|}
    \Big[\,\int_{K^{i}}\vect{\cM}_{h}\,dx^{i}-\f{\hat{c}\,\dt}{s_{i}}\big(\,\widehat{\bcF}^{i}(\vect{\cM}_{h})\big|_{\xH^{i}}-\widehat{\bcF}^{i}(\vect{\cM}_{h})\big|_{\xL^{i}}\,\big)\,\Big]\in\cR,
    \label{eq:realizableGamma}
  \end{equation}
  then $\vect{\cM}_{\bK}^{*}\in\cR$.  
\end{lemma}
\begin{proof}
  It is easy to show that $\vect{\cM}_{\bK}^{*}$ can be expressed as the convex combination
  \begin{equation}
    \vect{\cM}_{\bK}^{*}
    =\sum_{i=1}^{d}s_{i}\,\f{1}{|\tilde{\vect{\bK}}^{i}|}\int_{\tilde{\bK}^{i}}\vect{\Gamma}^{i}\big[\vect{\cM}_{h}\big]\,d\tilde{\vect{x}}^{i}.  
    \label{eq:cellAverageInTermsOfGamma}
  \end{equation}
  The result follows immediately.  
\end{proof}
\begin{rem}
  If a quadrature rule $\tilde{\vect{Q}}^{i}:C^{0}\to\bbR$, with positive weights, and points defined by the set $\tilde{\vect{S}}^{i}$, is used to approximate the integral over $\tilde{\bK}^{i}$ in \eqref{eq:cellAverageInTermsOfGamma}, it is sufficient for \eqref{eq:realizableGamma} to hold in the quadrature points $\tilde{\vect{S}}^{i}\subset\tilde{\bK}^{i}$.  
\end{rem}

Next, we establish conditions for which \eqref{eq:realizableGamma} holds.  
To simplify the notation, we temporarily drop the dimension index $i$, setting $x^{i}=x$, $K^{i}=K$, $\vect{\Gamma}^{i}=\vect{\Gamma}$, etc.  
We let $\hat{Q}_{N}$ denote the $N$-point \emph{Gauss-Lobatto (GL)} quadrature rule on the interval $K=(x_{\Low},x_{\Hgh})$, with points
\begin{equation}
  \hat{S}=\left\{x_{\Low}=\hat{x}_{1},\cdots,\hat{x}_{N}=x_{\Hgh}\right\}, 
  \label{eq:quadraturePointsGL}
\end{equation}
and weights $\hat{w}_{q} \in (0,1]$, normalized so that $\sum_{q=1}^{N} \hat{w}_{q} = 1$.  
(The hat is used to denote the GL rule, which includes the endpoints of the interval $K$.)
This quadrature integrates polynomials in $x \in \bbR$ with degree $\le2N-3$ exactly.  
Then, if $\vect{\cM}_{h}$ is represented by such polynomials we have
\begin{equation}
  \int_{K} \bcM_{h}\,dx = \hat{Q}_{N}[\bcM_{h}] \equiv
  |K| \sum_{q=1}^{N} \hat{w}_{q}\,\hat{\bcM}_{q}
  \label{eq:quadratureRuleGL}
\end{equation}
where $\hat{\bcM}_{q} := \bcM_{h}(\hat{x}_q,\tilde{\vect{x}})$.  
In each element, $\hat{\vect{\cM}}_{1}=\vect{\cM}_{\Low}^{+}$ and $\hat{\vect{\cM}}_{N}=\vect{\cM}_{\Hgh}^{-}$.  

With the GL quadrature rule in \eqref{eq:quadratureRuleGL} (note $\hat{w}_{1}=\hat{w}_{N}$), we can write $\vect{\Gamma}$ as the convex combination
\begin{equation}
  \vect{\Gamma}\big[\bcM_{h}\big]
  =\sum_{q=2}^{N-1}\hat{w}_{q}\,\hat{\vect{\cM}}_{q}
  +2\,\hat{w}_{N}\,\Phi(\vect{\cM}_{\Low}^{-},\vect{\cM}_{\Low}^{+},\vect{\cM}_{\Hgh}^{-},\vect{\cM}_{\Hgh}^{+}),
  \label{eq:realizableGammaConvex}
\end{equation}
where we have defined
\begin{align}
  &\Phi(\vect{\cM}_{\Low}^{-},\vect{\cM}_{\Low}^{+},\vect{\cM}_{\Hgh}^{-},\vect{\cM}_{\Hgh}^{+}) \nonumber \\
  &\hspace{12pt}
  =\f{1}{2}\big(\,\vect{\cM}_{\Low}^{+}+\lambda\,\mathscr{F}(\vect{\cM}_{\Low}^{-},\vect{\cM}_{\Low}^{+})\,\big)
  +\f{1}{2}\big(\,\vect{\cM}_{\Hgh}^{-}-\lambda\,\mathscr{F}(\vect{\cM}_{\Hgh}^{-},\vect{\cM}_{\Hgh}^{+})\,\big),
\end{align}
with $\lambda=\hat{c}\,\dt/(s\,\hat{w}_{N}\,|K|)$.  
The following Lemma establishes sufficient conditions for realizability of $\vect{\Gamma}$, and hence $\vect{\cM}_{\bK}^{*}$.  
\begin{lemma}
  Assume that $\hat{\vect{\cM}}_{q}\in\cR$ for all $q=1,\ldots,N$ and all $\bK\in\mathscr{T}$.  
  Let the time step $\dt$ be chosen so that $\lambda\le1$.  
  Let the numerical flux be given by the Lax-Friedrichs flux in Eq.~\eqref{eq:fluxFunctionLF} with $\alpha=1$.  
  Then $\vect{\Gamma}[\bcM_{h}]\in\cR$.  
\end{lemma}
\begin{proof}
  In Eq.~\eqref{eq:realizableGammaConvex}, $\vect{\Gamma}[\vect{\cM}_{h}]$ is expressed as a convex combination.  
  By assumption, $\hat{\vect{\cM}}_{q}\in\cR$ ($q=2,\ldots,N-1$).  
  It remains to show $\Phi(\vect{\cM}_{\Low}^{-},\vect{\cM}_{\Low}^{+},\vect{\cM}_{\Hgh}^{-},\vect{\cM}_{\Hgh}^{+})\in\cR$.  
  Using the Lax-Friedrichs flux with $\alpha=1$, it is straightforward to show that
  \begin{align}
    &\Phi(\vect{\cM}_{\Low}^{-},\vect{\cM}_{\Low}^{+},\vect{\cM}_{\Hgh}^{-},\vect{\cM}_{\Hgh}^{+})
    =(1-\lambda)\,\big(\,\f{1}{2}\,\vect{\cM}_{\Low}^{+}+\f{1}{2}\,\vect{\cM}_{\Hgh}^{-}\,\big) \nonumber \\
    &\hspace{12pt}
    +\f{1}{2}\,\lambda\,\big(\,\Phi^{+}(\vect{\cM}_{\Low}^{-})+\Phi^{-}(\vect{\cM}_{\Hgh}^{-})\,\big)
    +\f{1}{2}\,\lambda\,\big(\,\Phi^{+}(\vect{\cM}_{\Low}^{+})+\Phi^{-}(\vect{\cM}_{\Hgh}^{+})\,\big),
    \label{eq:phiConvex}
  \end{align}
  where $\Phi^{\pm}(\vect{\cM})=\f{1}{2}\,\big(\vect{\cM}\pm\vect{e}\cdot\vect{\cF}(\vect{\cM})\big)$.  
  Since $\lambda\le1$, $\Phi$ is expressed as a convex combination of three terms.  
  By assumption, $\vect{\cM}_{\Low}^{-},\vect{\cM}_{\Low}^{+},\vect{\cM}_{\Hgh}^{-},\vect{\cM}_{\Hgh}^{+}\in\cR$, which immediately implies realizability of the first term on the right-hand side of Eq.~\eqref{eq:phiConvex}.  
  Realizability of the second and third terms follows by invoking Lemma~\ref{lem:explicitStep}.  
  This completes the proof.  
\end{proof}