\clearpage
\section{Time Integration} \label{se:TimeIntegration}

Suppose that an algebraic closure based on Fermi-Dirac statistics is used (i.e., the Eddington factor satisfies Eq.~\eqref{eq:eddingtonFactorBounds}).
Here we consider the construction of an Implicit-Explicit (IMEX) time integration scheme which maintains the bounds in Eq.~\eqref{eq:MomentsBounds}.  
The semi-discretization of the two-moment model results in a system of ordinary differential equations of the form
\begin{equation}
  \dfrac{d \vect{u}}{d t} = \vect{\cT}(\vect{u}) + \f{1}{\tau}\,\vect{\cQ}(\vect{u}),
\end{equation}
where the solution vector
\begin{equation}
  \vect{u}(t) = \left( \bcM_{1}(t),\ldots,\bcM_{N}(t)\right) ^{T}
\end{equation}
is the collection of all cell-averaged moments, $\vect{\cT}$ is the transport operator, corresponding to the first term on the right-hand side of Eq.~\eqref{eq:SemiDiscretizatedMomentEquation}, and $\f{1}{\tau}\,\vect{\cQ}$ is the collision operator, corresponding to the second term on the right-hand side of Eq.~\eqref{eq:SemiDiscretizatedMomentEquation}.  

Since the set of realizable moments is convex, convex-invariant schemes, which maintain states in a convex set, can be used to design realizability-preserving schemes for the two-moment model. 
Ideally, the scheme should also be high-order accurate and work well in the asymptotic diffusion limit (characterized by frequent collisions and long time scales).  
The following discussion considers the construction of such convex-invariant schemes.  

\subsection{Standard IMEX Schemes}

Treating the transport operator explicitly and the collision operator implicitly, a standard $s$-stage IMEX scheme takes the following form \cite{pareschiRusso_2005}: 
\begin{align}
  \vect{u}^{(i)}
  &=\vect{u}^{n}
  +\dt\sum_{j=1}^{i-1}\tilde{a}_{ij}\,\vect{\cT}(\vect{u}^{(j)})
  +\dt\sum_{j=1}^{i}a_{ij}\,\f{1}{\tau}\,\vect{\cQ}(\vect{u}^{(j)}),
  \quad i=1,\ldots,s, \label{imexStages} \\
  \vect{u}^{n+1}
  &=\vect{u}^{n}
  +\dt\sum_{i=1}^{s}\tilde{w}_{i}\,\vect{\cT}(\vect{u}^{(i)})
  +\dt\sum_{i=1}^{s}w_{i}\,\f{1}{\tau}\,\vect{\cQ}(\vect{u}^{(i)}), \label{imexIntermediate} 
\end{align}
where $(\tilde{a}_{ij})$ and $(a_{ij})$, coefficients of the $i$-th stage, are the elements of matrices $\tilde{A}$ and $A$, respectively.
The vectors $\tilde{\vect{w}}=(\tilde{w}_{1},\ldots,\tilde{w}_{s})^{T}$ and $\vect{w}=(w_{1},\ldots,w_{s})^{T}$ are the weights in the assembly step in Eq.~\eqref{imexIntermediate}.
These coefficients and weights must satisfy certain order conditions for consistency and accuracy.  
For second-order temporal accuracy, the following conditions are required:
\begin{equation}
  \sum_{i=1}^{s}\tilde{w}_{i}=\sum_{i=1}^{s}w_{i}=1,
  \label{orderConditions1}
\end{equation}
and
\begin{equation}
  \sum_{i=1}^{s}\tilde{w}_{i}\,\tilde{c}_{i}
  =\sum_{i=1}^{s}\tilde{w}_{i}\,c_{i}
  =\sum_{i=1}^{s}w_{i}\,\tilde{c}_{i}
  =\sum_{i=1}^{s}w_{i}\,c_{i}=\f{1}{2}, 
  \label{orderConditions2}
\end{equation}
where $\tilde{c}_{i} = \sum_{j=1}^{s}\tilde{a}_{ij}$ and $c_{i}=\sum_{j=1}^{s}a_{ij}$.

\subsection{Constraint-Preserving Implicit-Explicit Schemes}
Beyond the accuracy requirement, a convex-invariant IMEX scheme must satisfy additional constraints.
Our idea is finding the constraints on $a_{ij}$, $\tilde{a}_{ij}$, $\tilde{w}_{i}$, and $w_{i}$ that enable each $\vect{u}^{(i)}$ and $\vect{u}^{n+1}$ be convex combination of realizable moments:

Following Hu et al\cite{hu_etal_2018}, the stage values in Eq.~\eqref{imexStages} can be rewritten as
\begin{equation}
  \vect{u}^{(i)}
  =\sum_{j=0}^{i-1}c_{ij}\Big[\,\vect{u}^{(j)}+\hat{c}_{ij}\,\dt\,\vect{\cT}(\vect{u}^{(j)})\,\Big]
  +a_{ii}\,\dt\,\f{1}{\tau}\,\vect{\cQ}(\vect{u}^{(i)}),\quad i=1,\ldots,s,
  \label{eq:imexStagesRewrite}
\end{equation}
with $c_{ij}$ and $\hat{c}_{ij}$ be some expression of $a_{ij}$ and $\tilde{a}_{ij}$.
By requiring the IMEX scheme be globally stiffly accurate (GSA), i.e. $a_{si}=w_{i}$ and $\tilde{a}_{si}=\tilde{w}_{i}$ for $i=1,\ldots,s$, $\vect{u}^{n+1} = \vect{u}^{(s)}$.
Using those Lemma proved in \cite{chu_etal_2018}, we can find those constraints that $c_{ij}$ and $\hat{c}_{ij}$ (or $a_{ij}$ and $\tilde{a}_{ij}$) need to satisfy to ensure $\vect{u}^{(i)}$ and $\vect{u}^{n+1}$ be realizable.

\subsection{Diffusion Accurate, Constraint-Preserving Implicit-Explicit Schemes}
Diffusion accurate is the other property the time integration should have.
In the diffusion limit, the distribution function is nearly isotropic so that $\vect{\cK}\approx\f{1}{3}\,\cJ\,\vect{I}$ and $\vect{\cH}\approx-\f{1}{3}\,\tau\,\nabla\cJ$.
The moment behavior are governed by (e.g., \cite{jinLevermore_1996})
\begin{equation}
  \pd{\cJ}{t} + \nabla\cdot\vect{\cH} = 0
  \quad\text{and}\quad
  \vect{\cH} = - \tau\,\nabla\cdot\vect{\cK}.  
  \label{eq:diffusionLimit}
\end{equation}
In the context of IMEX schemes, the above relationships imply that the relation $A\,\vec{\vect{\cH}}=-\f{1}{3}\,\tau\,\tilde{A}\,\nabla\vec{\cJ}$ should hold. 
We derived the diffusion accurate condition in \cite{chu_etal_2018} and proved that only type~ARS (investigated by Ascher, Ruuth, and Spiteri\cite{ascher_etal_1997}) IMEX schemes can be our candidates.

For type~ARS, $a_{i1} = 0$ for $i=1,\ldots,s$.
$c_{ij}$ and $\hat{c}_{ij}$ are given by
    \begin{equation}
     \begin{aligned}
      c_{i0} &= 1-\sum_{j=2}^{i-1}\sum_{l=j}^{i-1}a_{il}b_{lj}, \quad &
      c_{ij} &= \sum_{l=j}^{i-1}a_{il}b_{lj}, \\
      \tilde{c}_{i0} &= \tilde{a}_{i1}+\sum_{j=2}^{i-1}a_{ij}\tilde{b}_{j1}, \quad &
      \tilde{c}_{ij} &= \tilde{a}_{ij}+\sum_{l=j+1}^{i-1}a_{il}\tilde{b}_{lj},  
     \end{aligned}
     \label{eq:positivityCoefficientsARS}
    \end{equation}
    \begin{equation}
      b_{ii} = \f{1}{a_{ii}}, \quad
      b_{ij} = -\f{1}{a_{ii}}\sum_{l=j}^{i-1}a_{il}b_{lj}, \quad
      \tilde{b}_{ij} = -\f{1}{a_{ii}}\Big(\tilde{a}_{ij}+\sum_{l=j+1}^{i-1}a_{il}\tilde{b}_{lj}\Big).  
    \end{equation}
    Note that $c_{i1}=\tilde{c}_{i1}=0$ in Eq.~\eqref{eq:positivityCoefficientsARS} so that $\sum_{j=0}^{i-1}c_{ij}=1$.
    
Combining the conditions we have, we aim to find type~ARS IMEX scheme with.
\begin{enumerate}
    \item Consistency of the implicit coefficients:
    \begin{equation}
      \sum_{i=1}^{s}w_{i}=1.
    \end{equation}
    \item Second-order accuracy in the streaming limit:
    \begin{equation}
      \sum_{i=1}^{s}\tilde{w}_{i}=1
      \quad\text{and}\quad
      \sum_{i=1}^{s}\tilde{w}_{i}\,\tilde{c}_{i}=\f{1}{2},
      \label{eq:orderConditionsEx}
    \end{equation}
    \item Convex-invariant:
    \begin{align}
      &a_{ii}>0, \quad c_{i0},\tilde{c}_{i0}\ge0, \quad \text{for} \quad i=2,\ldots,s, \nonumber \\
      &\text{and} \quad c_{ij},\tilde{c}_{ij}\ge0, \quad \text{for} \quad i=3,\ldots,s, \quad\text{and}\quad j=2,\ldots,i-1.  
    \end{align}
    with $\sum_{j=0}^{i-1}c_{ij}=1$, for $i=1,\ldots,s$, and $c_{\Sch}=\min_{\substack{i = 2,\ldots,s \\ 
                  j = 0,2,\ldots,i-1}}\,\f{1}{\hat{c}_{ij}}>0$.
    \item Well-behaved in the diffusion limit:
    \begin{equation}
      \vect{e}_{i}^{T}A^{-1}\tilde{A}\,\vect{e} = 1, \quad i=2,\ldots,s,
      \label{eq:diffusionCondition}
    \end{equation}
    where $\vect{e}_{i}$ is the $i$th column of the $s\times s$ identity matrix.
    \item Less than five stages ($s\le4$).
    \item Globally stiffly accurate: $a_{si}=w_{i}$ and $\tilde{a}_{si}=\tilde{w}_{i},\quad i=1,\ldots,s$. 
\end{enumerate}  
We call the IMEX scheme satisfying the above conditions {PD-ARS}. (Definition 3 in \cite{chu_etal_2018}.)
We give two optimized PD-ARS schemes here: PD-ARS with SSPRK2 and  PD-ARS with SSPRK3. 
They have second- and third-order accuracy in the streaming limit, respectively.
\subsubsection{PD-ARS with SSPRK2}
Here we give the optimized PD-ARS with SSPRK2 in the standard double Butcher tableau form: explicit tableau on the left ($\tilde{A}$), implicit tableau on the right ($A$):
\begin{equation}
  \begin{array}{c | c c c}
  	0 & 0   & 0 & 0 \\
  	1 & 1   & 0 & 0 \\
  	1 & 1/2 & 1/2 & 0 \\ \hline
  	  & 1/2 & 1/2 & 0
  \end{array}
  \qquad
  \begin{array}{c | c c c}
  	0 & 0 & 0            & 0            \\
  	1 & 0 & 1            & 0            \\
  	1 & 0 & 1/2 & 1/2 \\ \hline
  	  & 0 & 1/2 & 1/2
  \end{array}
\end{equation}
For this scheme, $c_{\mbox{\tiny Sch}}= 1$ and only two implicit solver are needed for each time step.
\subsubsection{PD-ARS with SSPRK3}
Here we give the optimized PD-ARS with SSPRK3.
Its standard double Butcher tableau are (explicit tableau on the left, implicit tableau on the right)
\begin{equation}
  \begin{array}{c | c c c c}
  	    &     &     &     &  \\
  	 1  & 1   &     &     &  \\
  	1/2 & 1/4 & 1/4 &  \\
  	 1  & 1/6 & 1/6 & 2/3 &  \\ \hline
  	    & 1/6 & 1/6 & 2/3 &
  \end{array}
  \qquad
  \begin{array}{c | c c c c}
  	0 & 0 & 0            & 0            \\
  	1 & 0 & 1            & 0            \\
  	1/2 & 0 & 1/4 & 1/4 \\ 
  	1 & 0 & 1/6 & 1/6 & 2/3\\\hline
  	  & 0 & 1/6 & 1/6 & 2/3
  \end{array}
\end{equation}
For this schemes, $c_{\mbox{\tiny Sch}}= 1$.
Three implicit solver are taken for each time step.
Since PD-ARS with SSPRK3 is as accurate as PD-ARS with SSPRK2 in collision involved region, see Section~\ref{se:NumericalTests} for the plots, it may not offer any advantage.

\clearpage