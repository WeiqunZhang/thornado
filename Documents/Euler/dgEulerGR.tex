\documentclass[10pt,preprint]{aastex}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{booktabs}
\usepackage{mathrsfs}
\usepackage{cite}
\usepackage{times}
\usepackage{url}
\usepackage{hyperref}
\usepackage{lineno}
\usepackage{yhmath}
\usepackage{natbib}
\usepackage{../definitions}
\hypersetup{
  bookmarksnumbered = true,
  bookmarksopen=false,
  pdfborder=0 0 0,         % make all links invisible, so the pdf looks good when printed
  pdffitwindow=true,      % window fit to page when opened
  pdfnewwindow=true, % links in new window
  colorlinks=true,           % false: boxed links; true: colored links
  linkcolor=blue,            % color of internal links
  citecolor=magenta,    % color of links to bibliography
  filecolor=magenta,     % color of file links
  urlcolor=cyan              % color of external links
}

\usepackage{graphicx}
\newtheorem{remark}{Remark}
\graphicspath{{Figures/}}

\begin{document}

\title{Nodal Discontinuous Galerkin Method for the Euler Equations in GR}
\author{Samuel J Dunham\altaffilmark{1}, Eirik Endeve\altaffilmark{2}, et al.}
\altaffiltext{2}{Department of Astronomy, Vanderbilt University, 6301 Stevenson Science Center, Nashville TN, 37212, USA; samuel.j.dunham@vanderbilt.edu}
\altaffiltext{2}{Computational and Applied Mathematics Group, Oak Ridge National Laboratory, Oak Ridge, TN 37831-6354, USA; endevee@ornl.gov}

\tableofcontents

\section{Discontinuous Galerkin Scheme}
\label{sec:dgMethod}

We assume a spacetime metric
\begin{equation}
  ds^{2}=-\alpha^{2}\,dt^{2}+\gamma_{ij}\,dx^{i}\,dx^{j},
\end{equation}
and consider the system of conservation laws with sources
\begin{equation}
  \pd{}{t}\big(\sqrt{\gamma}\,\bU\big)+\sum_{i=1}^{d}\pd{}{i}\big(\alpha\,\sqrt{\gamma}\,\bF^{i}(\bU)\big)=\alpha\,\sqrt{\gamma}\,\bG(\bU),
  \label{eq:conservationLaws}
\end{equation}
where
\begin{align}
  \bU
  &=\big(D,\,S_{j},\,\tau\big)^{\mbox{\tiny T}}
  =\big(\rho\,W,\,\rho\,h\,W^{2}\,v_{j},\,\rho\,W\left(h\,W-1\right)-p\big)^{\mbox{\tiny T}}, \\
  \bF^{i}(\bU)
  &=\big(D\,v^{i},\,\big)^{\mbox{\tiny T}}
\end{align}


\section{Bound-Preserving Methods Using First-Order DG Scheme}

\subsection{Cartesian Coordinates}
This section closely follows \citet{Qin2016}.

\subsubsection{Set of Admissible States}
We consider a one-dimensional system of conservation laws:
\begin{equation}
    \pd{\,\bU}{t} + \pd{\,\bF\left(\bU\right)}{x} = \vect{0},
\end{equation}
where $\bU$ is a vector of conserved variables, defined as:
\begin{equation}\label{Eq:ConservedVariables}
    \bU\longrightarrow\begin{pmatrix} D\\ S\\ \tau\end{pmatrix}=\begin{pmatrix} \rho\,W\\ \rho\,h\,W^{2}\,v\\ \rho\,W\left(h\,W-1\right)-p\end{pmatrix},
\end{equation}
and $\bF\left(\bU\right)$ are the fluxes of those conserved quantities:
\begin{equation}\label{Eq:FluxVector}
    \bF\left(\bU\right)\longrightarrow\begin{pmatrix}\rho\,W\,v\\ \rho\,h\,W^{2}\,v^{2}+p\\\rho\,h\,W^{2}\,v-D\,v\end{pmatrix}.
\end{equation}


The physics leads us to define a set of admissible states, $\cG_{p}$ (the subscript $p$ stands for primitive), as:
\begin{equation}
    \cG_{p}\equiv\left\{\bU\Big|\rho>0,\,p>0,\,v^{2}<1\right\}.
\end{equation}

It is shown in \citet{Mignone2005} that $\cG$ is a convex set\footnote{Convex in the sense that if $\bU_{1}\in\cG$ and $\bU_{2}\in\cG$, then $\alpha_{1}\,\bU_{1}+\alpha_{2}\,\bU_{2}\in\cG$, where $\alpha_{1},\,\alpha_{2}\in\left[0,1\right]$ and $\alpha_{1}+\alpha_{2}=1$.} and can equivalently be written in terms of the conserved variables as:
\begin{equation}\label{Eq:SetOfAdmissibleStates}
    \cG\equiv\left\{\bU\Big|D>0,\,\tau+D>\sqrt{D^{2}+S^{2}}\right\}.
\end{equation}

\subsubsection{Time-Step Derivation/CFL Condition}
For the first-order DG method using forward-Euler time-stepping, we evolve the vector of conserved variables as:
\begin{equation}\label{Eq:1stOrderDG}
    \ol{\bU}^{n+1}_{i}=\ol{\bU}^{n}_{i}-\eta_{i}\left[\hat{\bF}\left(\ol{\bU}^{n}_{i},\ol{\bU}^{n}_{i+1}\right)-\hat{\bF}\left(\ol{\bU}^{n}_{i-1},\ol{\bU}^{n}_{i}\right)\right],
\end{equation}
where
\begin{equation}
    \ol{\bU}_{i}\equiv\f{1}{\Delta x_{i}}\int_{x_{\imh}}^{x_{\iph}}\bU_{i}\,dx,
\end{equation}
$\eta_{i}\equiv\Delta t_{i}/\Delta x_{i}$, and $\hat{\bF}$ is the numerical flux. In this document we use the local Lax-Friedrichs flux, defined as:
\begin{equation}\label{Eq:LLF}
    \hat{\bF}\left(a,b\right)=\f{1}{2}\left[\bF\left(a\right)+\bF\left(b\right) - \alpha_{ab}\left(b-a\right)\right],
\end{equation}
where $a$ and $b$ represent the state of the fluid in two different elements, $\alpha_{ab}$ is an estimate for the wave-speed:
\begin{equation}
    \alpha_{ab}=\text{max}\left[\alpha\left(a\right),\alpha\left(b\right)\right],
\end{equation}
and $\alpha$ is the largest (in absolute value) eigenvalue of the flux-Jacobian:
\begin{equation}
    \alpha=\left|\left|\pderiv{\bF}{\bU}\right|\right|.
\end{equation}
Using this we define the following variables:
\begin{equation}\label{Eq:EigVals}
    \alpha_{\iph}=\text{max}\left[\alpha\left(\ol{\bU}_{i}\right),\alpha\left(\ol{\bU}_{i+1}\right)\right],\hspace{3em} \alpha_{\imh}=\text{max}\left[\alpha\left(\ol{\bU}_{i-1}\right),\alpha\left(\ol{\bU}_{i}\right)\right].
\end{equation}

Substituting \eqref{Eq:LLF} with \eqref{Eq:EigVals} into \eqref{Eq:1stOrderDG}:
\begin{align}
    \ol{\bU}^{n+1}_{i}&=\ol{\bU}^{n}_{i}-\f{\eta_{i}}{2}\left[\bF\left(\ol{\bU}^{n}_{i}\right)+\bF\left(\ol{\bU}^{n}_{i+1}\right)-\alpha_{\iph}\left(\ol{\bU}^{n}_{i+1}-\ol{\bU}^{n}_{i}\right)\right.\nonumber\\
    &\left.\hspace{7em}-\bF\left(\ol{\bU}^{n}_{i}\right)-\bF\left(\ol{\bU}^{n}_{i-1}\right)+\alpha_{\imh}\left(\ol{\bU}^{n}_{i}-\ol{\bU}^{n}_{i-1}\right)\right]\nonumber\\
    &=\left[1-\f{\eta_{i}}{2}\left(\alpha_{\iph}+\alpha_{\imh}\right)\right]\ol{\bU}^{n}_{i}+\f{\eta_{i}}{2}\,\alpha_{\iph}\left[\ol{\bU}^{n}_{i+1}-\f{1}{\alpha_{\iph}}\bF\left(\ol{\bU}^{n}_{i+1}\right)\right]\nonumber\\
    &\hspace{15em}+\f{\eta_{i}}{2}\,\alpha_{\imh}\left[\ol{\bU}^{n}_{i-1}+\f{1}{\alpha_{\imh}}\bF\left(\ol{\bU}^{n}_{i-1}\right)\right]\nonumber\\
    &=\left[1-\f{\eta_{i}}{2}\left(\alpha_{\iph}+\alpha_{\imh}\right)\right]\ol{\bU}^{n}_{i}+\f{\eta_{i}}{2}\,\alpha_{\iph}\,\ol{\bH}^{-}\left(\ol{\bU}^{n}_{i+1},\alpha_{\iph}\right)+\f{\eta_{i}}{2}\,\alpha_{\iph}\,\ol{\bH}^{+}\left(\ol{\bU}^{n}_{i-1},\alpha_{\imh}\right),\label{Eq:ConvComb}
\end{align}
where
\begin{equation}\label{Eq:Hpm}
    \ol{\bH}^{\pm}\left(\ol{\bU},\alpha\right)\equiv\ol{\bU}\pm\f{1}{\alpha}\,\bF\left(\ol{\bU}\right).
\end{equation}

The proof that $\ol{\bH}^{\pm}\in\cG$ is given in \citet{Qin2016}. Therefore, we see that with a restriction on $\alpha_{i\pm\f{1}{2}}$ that \eqref{Eq:ConvComb} is a convex combination. The restriction is (recalling that $\eta_{i}=\Delta t_{i}/\Delta x_{i}$):
\begin{equation}
    1-\f{\eta_{i}}{2}\left(\alpha_{\iph}+\alpha_{\imh}\right)>0\implies\f{\eta_{i}}{2}\left(\alpha_{\iph}+\alpha_{\imh}\right)<1\implies \Delta t_{i}<\f{2\,\Delta x_{i}}{\alpha_{\iph}+\alpha_{\imh}}\leq\f{\Delta x_{i}}{\text{max}\left(\alpha_{i\pm\f{1}{2}}\right)}.
\end{equation}

We want a time-step that is the same for all elements at a given time, so we tighten the restriction to:
\begin{equation}
    \Delta t<\text{min}_{i}\left(\f{\Delta x_{i}}{\text{max}\left(\alpha_{i\pm\f{1}{2}}\right)}\right)=\f{\Delta x}{\text{max}_{i}\left(\alpha_{i\pm\f{1}{2}}\right)},
\end{equation}
where the equality follows for a uniform mesh, i.e. $\Delta x_{i}=\Delta x\,\forall i$.

\newpage


\subsection{Curvilinear Coordinates}
NOTE: We assume a conformally-flat, time-independent spatial three-metric:
\begin{equation}
    \gamma_{ij}\left(x^{k},t\right)\longrightarrow\psi^{4}\left(x^{k}\right)\,\ol{\gamma_{ii}}\left(x^{k}\right),
\end{equation}
where $\psi\left(x^{k}\right)$ is the conformal factor and $\ol{\gamma}_{ii}$ is the flat-space metric.

\subsubsection{Set of Admissible States}
We again consider a one-dimensional system of conservation laws, but this time with a curvilinear metric:
\begin{equation}
    \pd{\left(\sqrtgm\,\bU\right)}{t}+\pd{\left(\sqrtgm\,\bF\right)}{1}=\sqrtgm\,\bQ,
\end{equation}
where $\bU$ is given by:
\begin{equation}
    \bU\longrightarrow\begin{pmatrix} D\\ S_{1}\\ \tau\end{pmatrix}=\begin{pmatrix} \rho\,W\\ \rho\,h\,W^{2}\,v_{1}\\ \rho\,W\left(h\,W-1\right)-p\end{pmatrix}=\begin{pmatrix} \rho\,W\\ \rho\,h\,W^{2}\,\gamma_{1j}\,v^{j}\\ \rho\,W\left(h\,W-1\right)-p\end{pmatrix},
\end{equation}
$\bF\left(\bU\right)$ are the fluxes of those conserved quantities:
\begin{equation}
    \bF\left(\bU\right)\longrightarrow\begin{pmatrix}D\,v^{1}\\ S^{1}\,v_{1}+p\,\delta^{1}_{~1}\\ S^{1}-D\,v^{1}\end{pmatrix}=\begin{pmatrix}\rho\,W\,v^{1}\\ \rho\,h\,W^{2}\,v^{1}\,v_{1}+p\\\rho\,h\,W^{2}\,v^{1}-D\,v^{1}\end{pmatrix}=\begin{pmatrix}\rho\,W\,v^{1}\\ \rho\,h\,W^{2}\,\gamma_{1j}\,v^{1}\,v^{j}+p\\\rho\,h\,W^{2}\,v^{1}-D\,v^{1}\end{pmatrix},
\end{equation}
and $\bQ$ is a source term:
\begin{align}
    \bQ\longrightarrow\begin{pmatrix}0\\\f{1}{2}\,P^{kj}\,\pd{\gamma_{kj}}{1}\\0\end{pmatrix}&=\begin{pmatrix}0\\ \f{1}{2}\left[P^{11}\,\pd{\gamma_{11}}{1}+P^{22}\,\pd{\gamma_{22}}{1}+P^{33}\,\pd{\gamma_{33}}{1}\right] \\0\end{pmatrix}\\
    &=\begin{pmatrix}0\\ P^{11}\,h_{1}\,\pd{\,h_{1}}{1}+P^{22}\,h_{2}\,\pd{\,h_{2}}{1}+P^{33}\,h_{3}\,\pd{\,h_{3}}{1} \\0\end{pmatrix},
\end{align}
where we have used the fact that $\gamma_{jj}=\left(h_{j}\right)^{2}$. The $P^{kj}$ are components of the pressure tensor:
\begin{equation}
    P^{kj}=S^{k}\,v^{j}+p\,\gamma^{kj}=\gamma^{k\ell}\,S_{\ell}\,v^{j}+p\,\gamma^{kj}=\gamma^{k\ell}\,S_{\ell}\,v^{j}+p\,\gamma^{k\ell}\,\delta^{j}_{~\ell}=\gamma^{k\ell}\left(S_{\ell}\,v^{j}+p\,\delta^{j}_{~\ell}\right).
\end{equation}
Since the spatial three-metric is diagonal we must have that $\ell=k$. We can therefore simplify further:
\begin{equation}
    P^{kj}=\gamma^{kk}\left(S_{k}\,v^{j}+p\,\delta^{j}_{~k}\right)=\f{1}{\gamma_{kk}}\,\left(S_{k}\,v^{j}+p\,\delta^{j}_{~k}\right)=\f{1}{\left(h_{k}\right)^{2}}\,\left(S_{k}\,v^{j}+p\,\delta^{j}_{~k}\right)
\end{equation}
For the pressure-tensor sum, we then have:
\begin{equation}\label{Eq:PressureTensorSum}
    P^{kj}\,\p_{1}\,\gamma_{kj}=P^{kk}\,\p_{1}\,\gamma_{kk}=P^{kk}\,\p_{1}\left(h_{k}\right)^{2}=2\,P^{kk}\,h_{k}\,\p_{1}\,h_{k}=\f{2}{h_{k}}\left(S_{k}\,v^{k}+p\right)\,\p_{1}\,h_{k}.
\end{equation}

These definitions lead us to define the same set of admissible states as before, namely:
\begin{equation}
    \cG_{p}\equiv\left\{\bU\Big|\rho>0,\,p>0,\,v^{2}<1\right\},
\end{equation}
the only difference being that $v^{2}$ now involves the metric:
\begin{equation}
    v^{2}=v^{j}\,v_{j}=\gamma_{kj}\,v^{k}\,v^{j}.
\end{equation}

Before continuing, we show that the introduction of the metric doesn't affect the translation between $\cG_{p}$ and $\cG$...\sd{I've shown this, just need to TeX it up}

\subsubsection{Time-Step Derivation/CFL Condition}
We start by integrating both sides over $dx^{1}$ and dividing by the volume, $\Delta V_{i}$:
\begin{equation}
    \f{1}{\Delta V_{i}}\int_{x^{1}_{\imh}}^{x^{1}_{\iph}}\pd{\left(\sqrtgm\,\bU_{i}\right)}{t}dx^{1}+\f{1}{\Delta V_{i}}\int_{x^{1}_{\imh}}^{x^{1}_{\iph}}\pd{\left(\sqrtgm\,\bF\left(\bU_{i}\right)\right)}{1}dx^{1}=\f{1}{\Delta V_{i}}\int_{x^{1}_{\imh}}^{x^{1}_{\iph}}\sqrtgm\,\bQ_{i}\,dx^{1},
\end{equation}
where:
\begin{equation}
    \Delta V_{i}=\int_{x^{1}_{\imh}}^{x^{1}_{\iph}}dV=\int_{x^{1}_{\imh}}^{x^{1}_{\iph}}\sqrtgm\,dx^{1}.
\end{equation}

By defining the cell-average as:
\begin{equation}
    \ol{\bW}_{i}\equiv\f{1}{\Delta V_{i}}\int_{x^{1}_{\imh}}^{x^{1}_{\iph}}\bW_{i}\,dV,
\end{equation}
we have:
\begin{equation}
    \f{d\,\ol{\bU}_{i}}{dt}+\f{1}{\Delta V_{i}}\left.\left(\sqrtgm\,\hat{\bF}\left(\ol{\bU}\right)\right)\right|^{x^{1}_{\iph}}_{x^{1}_{\imh}}=\ol{\bQ}_{i},
\end{equation}
or, using the common notation of the time step being represented as a superscript and the spatial element represented by a subscript:
\begin{equation}
    \ol{\bU}^{n+1}_{i}=\ol{\bU}^{n}_{i}-\f{\Delta t_{i}}{\Delta V_{i}}\left[\sqrtgm_{\iph}\,\hat{\bF}^{n}_{\iph}-\sqrtgm_{\imh}\,\hat{\bF}^{n}_{\imh}\right]+\Delta t_{i}\,\ol{\bQ}^{n}_{i}.
\end{equation}

Now we define a parameter a la \citet{ZS2011b}: $\ve\in\left(0,1\right)$, such that (NOTE: \citet{ZS2011b} set $\ve=1/2$):
\begin{equation}
    \ol{\bU}^{n}_{i}=\ve\,\ol{\bU}^{n}_{i}+\left(1-\ve\right)\ol{\bU}^{n}_{i}.
\end{equation}
We can use the first term to balance out the term in the square brackets and the second term to balance out the source term.

So, we get:
\begin{align}
    \ol{\bU}^{n+1}_{i}&=\ve\left\{\ol{\bU}^{n}_{i}-\f{\Delta t_{i}}{\ve\,\Delta V_{i}}\left[\sqrtgm_{\iph}\,\hat{\bF}^{n}_{\iph}-\sqrtgm_{\imh}\,\hat{\bF}^{n}_{\imh}\right]\right\}+\left(1-\ve\right)\ol{\bU}^{n}_{i}+\Delta t_{i}\,\ol{\bQ}^{n}_{i}\\
    &=\ve\left\{\ol{\bU}^{n}_{i}-\eta_{i}\left[\sqrtgm_{\iph}\,\hat{\bF}\left(\ol{\bU}^{n}_{i+1},\ol{\bU}^{n}_{i}\right)-\sqrtgm_{\imh}\,\hat{\bF}\left(\ol{\bU}^{n}_{i},\ol{\bU}^{n}_{i-1}\right)\right]\right\}+\left(1-\ve\right)\ol{\bU}^{n}_{i}+\Delta t_{i}\,\ol{\bQ}^{n}_{i}\\
    &=\ve\,\ol{\bH}_{1}+\left(1-\ve\right)\ol{\bH}_{2},
\end{align}
where
\begin{equation}
    \ol{\bH}_{1}\equiv \ol{\bU}^{n}_{i}-\eta_{i}\left[\sqrtgm_{\iph}\,\hat{\bF}\left(\ol{\bU}^{n}_{i+1},\ol{\bU}^{n}_{i}\right)-\sqrtgm_{\imh}\,\hat{\bF}\left(\ol{\bU}^{n}_{i},\ol{\bU}^{n}_{i-1}\right)\right],
\end{equation}
\begin{equation}
    \ol{\bH}_{2}\equiv\ol{\bU}^{n}_{i}+\f{\Delta t_{i}}{1-\ve}\,\ol{\bQ}^{n}_{i},
\end{equation}
and
\begin{equation}
    \eta_{i}\equiv\f{\Delta t_{i}}{\ve\,\Delta V_{i}}.
\end{equation}

We proceed by focusing on each term individually, starting with the numerical flux term, $\ol{\bH}_{1}$.

\subsubsection{Numerical flux term}
We have to show that $\ol{\bH}_{1}\in\cG$. We again we use the Local-Lax-Friedrichs flux, \eqref{Eq:LLF}, yielding for $\ol{\bH}_{1}$:
\begin{align}
    \ol{\bU}^{n}_{i}-\f{\eta_{i}}{2}\Big\{&\sqrtgm_{\iph}\left[\bF\left(\ol{\bU}^{n}_{i+1}\right)+\bF\left(\ol{\bU}^{n}_{i}\right)-\alpha_{\iph}\left(\ol{\bU}^{n}_{i+1}-\ol{\bU}^{n}_{i}\right)\right]\\
    &-\sqrtgm_{\imh}\left[\bF\left(\ol{\bU}^{n}_{i}\right)+\bF\left(\ol{\bU}^{n}_{i-1}\right)-\alpha_{\imh}\left(\ol{\bU}^{n}_{i}-\ol{\bU}^{n}_{i-1}\right)\right]\Big\}\\
    &\hspace{-10em}=\left(1-\f{1}{2}\,\eta_{i}\,\sqrtgm_{\iph}\,\alpha_{\iph}-\f{1}{2}\,\eta_{i}\,\sqrtgm_{\imh}\,\alpha_{\imh}\right)\ol{\bU}^{n}_{i}\\
    &\hspace{-8em}-\f{1}{2}\,\eta_{i}\,\sqrtgm_{\iph}\,\bF\left(\ol{\bU}^{n}_{i}\right)+\f{1}{2}\,\eta_{i}\,\sqrtgm_{\imh}\,\bF\left(\ol{\bU}^{n}_{i}\right)\\
    &\hspace{-8em}+\f{1}{2}\,\eta_{i}\,\sqrtgm_{\imh}\,\alpha_{\imh}\left[\ol{\bU}^{n}_{i-1}+\f{1}{\alpha_{\imh}}\bF\left(\ol{\bU}^{n}_{i-1}\right)\right]+\f{1}{2}\,\eta_{i}\,\sqrtgm_{\iph}\,\alpha_{\iph}\left[\ol{\bU}^{n}_{i+1}-\f{1}{\alpha_{\iph}}\bF\left(\ol{\bU}^{n}_{i+1}\right)\right].
\end{align}
Now we add and subtract $\f{1}{2}\,\eta_{i}\,\sqrtgm_{\iph}\,\alpha_{\iph}\,\ol{\bU}^{n}_{i}$ and $\f{1}{2}\,\eta_{i}\,\sqrtgm_{\imh}\,\alpha_{\imh}\,\ol{\bU}^{n}_{i}$, yielding:
\begin{align}
    &\left(1-\eta_{i}\,\sqrtgm_{\iph}\,\alpha_{\iph}-\eta_{i}\,\sqrtgm_{\imh}\,\alpha_{\imh}\right)\ol{\bU}^{n}_{i}\\
    &+\f{1}{2}\,\eta_{i}\,\sqrtgm_{\iph}\,\alpha_{\iph}\left[\ol{\bU}^{n}_{i}-\f{1}{\alpha_{\iph}}\bF\left(\ol{\bU}^{n}_{i}\right)\right]+\f{1}{2}\,\eta_{i}\,\sqrtgm_{\imh}\,\alpha_{\imh}\left[\ol{\bU}^{n}_{i}+\f{1}{\alpha_{\imh}}\bF\left(\ol{\bU}^{n}_{i}\right)\right]\\
    &+\f{1}{2}\,\eta_{i}\,\sqrtgm_{\imh}\,\alpha_{\imh}\left[\ol{\bU}^{n}_{i-1}+\f{1}{\alpha_{\imh}}\bF\left(\ol{\bU}^{n}_{i-1}\right)\right]+\f{1}{2}\,\eta_{i}\,\sqrtgm_{\iph}\,\alpha_{\iph}\left[\ol{\bU}^{n}_{i+1}-\f{1}{\alpha_{\iph}}\bF\left(\ol{\bU}^{n}_{i+1}\right)\right].
\end{align}
All of the terms in square brackets are similar to the $\ol{\bH}$ quantities in \citet{Qin2016}, and are therefore in $\cG$. It can easily be seen that the sum of the coefficients is unity. The final condition is that the coefficient of $\ol{\bU}^{n}_{i}>0$, or (recalling that $\eta_{i}=\Delta t_{i}/\left(\ve\,\Delta V_{i}\right)$):
\begin{align}
    1&-\eta_{i}\,\sqrtgm_{\iph}\,\alpha_{\iph}-\eta_{i}\,\sqrtgm_{\imh}\,\alpha_{\imh}>0\implies\eta_{i}\left(\sqrtgm_{\iph}\,\alpha_{\iph}+\sqrtgm_{\imh}\,\alpha_{\imh}\right)<1\\
    &\implies\Delta t_{i}<\f{\ve\,\Delta V_{i}}{\sqrtgm_{\iph}\,\alpha_{\iph}+\sqrtgm_{\imh}\,\alpha_{\imh}}\leq\f{\ve\,\Delta V_{i}}{2\,\text{max}\left(\sqrtgm_{i\pm\f{1}{2}}\,\alpha_{i\pm\f{1}{2}}\right)}.
\end{align}
Again we want a time-step that is the same for all elements at a given time, so:
\begin{equation}
    \Delta t<\text{min}_{i}\left(\f{\ve\,\Delta V_{i}}{2\,\text{max}\left(\sqrtgm_{i\pm\f{1}{2}}\,\alpha_{i\pm\f{1}{2}}\right)}\right).
\end{equation}

We close the numerical flux section by writing the explicit form of the time-step for spherical-polar coordinates.

\subsubsubsection{Time-step for Spherical-Polar Coordinates}
For spherical-polar coordinates in 1-D we have that $\Delta V_{i}=1/3\left(r_{\iph}^{3}-r_{\imh}^{3}\right)$, and (assuming $\alpha_{i\pm\f{1}{2}}=1\ \forall\ i$) $\text{max}\left(\sqrtgm_{i\pm\f{1}{2}}\,\alpha_{i\pm\f{1}{2}}\right)=r_{\iph}^{2}$, so:
\begin{align}
    \Delta t&<\text{min}_{i}\left\{\f{\ve\,1/3\left[r_{\iph}^{3}-r_{\imh}^{3}\right]}{2\,r_{\iph}^{2}}\right\}\\
    &=\text{min}_{i}\left\{\f{\ve}{6}\,r_{\iph}\left[1-\f{r_{\imh}^{3}}{r_{\iph}^{3}}\right]\right\}\\
    &=\text{min}_{i}\left\{\f{\ve}{6}\,r_{\iph}\left[1-\left(1-\f{\Delta r_{i}}{r_{\iph}}\right)^{3}\right]\right\}\\
    &=\text{min}_{i}\left\{\f{\ve}{6}\,r_{\iph}\left[1-\left(1+\left(\f{\Delta r_{i}}{r_{\iph}}\right)^{2}-2\frac{\Delta r_{i}}{r_{\iph}}\right)\left(1-\f{\Delta r_{i}}{r_{\iph}}\right)\right]\right\}\\
    &=\text{min}_{i}\left\{\f{\ve}{6}\,r_{\iph}\left[\left(\f{\Delta r_{i}}{r_{\iph}}\right)^{3}-3\left(\f{\Delta r_{i}}{r_{\iph}}\right)^{2}+3\f{\Delta r_{i}}{r_{\iph}}\right]\right\}\\
    &=\text{min}_{i}\left\{\f{\ve}{6}\,\Delta r_{i}\left[\left(\f{\Delta r_{i}}{r_{\iph}}\right)^{2}-3\left(\f{\Delta r_{i}}{r_{\iph}}\right)+3\right]\right\}.
\end{align}
We know that $\Delta r_{i}/r_{\iph}\in\left[0,1\right]$; the minimum value of the quadratic function in this domain is unity. So, we have that for spherical-polar coordinates:
\begin{equation}
    \Delta t<\f{\ve}{6}\,\text{min}\left(\Delta r_{i}\right).
\end{equation}

Next we handle the source term.

\subsubsection{Source term}
For this section we drop the subscript $i$ and the superscript $n$. We have to show that $\ol{\bH}_{2}\in\cG$, where
\begin{equation}
    \ol{\bH}_{2}=\begin{pmatrix}\ol{D}\\ \ol{S}_{1}+\f{\Delta t}{2\left(1-\ve\right)}\ol{P^{kk}\,\pd{\gamma_{kk}}{1}} \\ \ol{\tau}\end{pmatrix},\hspace{1em}\left(\ol{H}_{2}\right)_{1}>0,\hspace{1em}\left(\ol{H}_{2}\right)_{3}+\left(\ol{H}_{2}\right)_{1}>\sqrt{\left(\ol{H}_{2}\right)_{1}\left(\ol{H}_{2}\right)_{1}+\left(\ol{H}_{2}\right)_{2}\left(\ol{H}_{2}\right)^{2}}.
\end{equation}

It is clear that the first requirement for $\ol{\bH}_{2}$ is met, i.e. $\ol{D}>0$. The second requirement is:
\begin{align}
    \ol{D}+\ol{\tau}&>\sqrt{\ol{D}^{2}+\left[\ol{S}_{1}+\f{\Delta t}{2\left(1-\ve\right)}\ol{P^{kk}\,\pd{\gamma_{kk}}{1}}\right] \left[\ol{S}^{1}+\f{\Delta t}{2\left(1-\ve\right)}\ol{P^{kk}\,\p^{1}\,\gamma_{kk}}\right] }\\
    &=\sqrt{\ol{D}^{2}+\left[\ol{S}_{1}+\f{\Delta t}{2\left(1-\ve\right)}\ol{P^{kk}\,\pd{\gamma_{kk}}{1}}\right] \left[\ol{S}^{1}+\gamma^{11}\f{\Delta t}{2\left(1-\ve\right)}\ol{P^{kk}\,\pd{\gamma_{kk}}{1}}\right] }\\
    &=\sqrt{\ol{D}^{2}+\ol{S}_{1}\,\ol{S}^{1}+\gamma^{11}\left[\f{\ol{P^{kk}\,\pd{\gamma_{kk}}{1}}}{2\left(1-\ve\right)}\right]^{2}\left(\Delta t\right)^{2}+\f{\ol{P^{kk}\,\pd{\gamma_{kk}}{1}}}{2\left(1-\ve\right)}\left[\ol{S}_{1}\,\gamma^{11}+\ol{S}^{1}\right]\Delta t}\\
    &=\sqrt{a\left(\Delta t\right)^{2}+b\,\Delta t+c}\geq0,
\end{align}
where
\begin{align}
    a&=\left[\f{\ol{P^{kk}\,\pd{\gamma_{kk}}{1}}}{2\,\sqrt{\ol{\gamma_{11}}}\left(1-\ve\right)}\right]^{2}\geq0\\
    b&=\f{\ol{P^{kk}\,\pd{\gamma_{kk}}{1}}}{\ol{\gamma_{11}}\left(1-\ve\right)}\ol{S}_{1}=\f{2\,\ol{S}_{1}}{\sqrt{\ol{\gamma_{11}}}}\sqrt{a}\\
    c&=\ol{D}^{2}+\ol{S}_{1}\,\ol{S}^{1}\geq0.
\end{align}
The condition for a quadratic function to be positive-definite is that $a>0$ (concave-up) and $b^{2}-4\,a\,c<0$ (no real roots). The first condition is clearly met. For the second condition:
\begin{equation}
    b^{2}-4\,a\,c=\f{4\left(\ol{S}_{1}\right)^{2}}{\ol{\gamma_{11}}}a-4\,a\left(\ol{D}^{2}+\ol{S}_{1}\,\ol{S}^{1}\right)=4\,\ol{S}_{1}\,\ol{S}^{1}\,a-4\,a\ol{D}^{2}-4\,a\,\ol{S}_{1}\,\ol{S}^{1}=-4\,a\,\ol{D}^{2}<0.
\end{equation}
So, the square root is always positive.

With that we have:
\begin{align}
    &\ol{D}^{2}+\ol{\tau}^{2}+2\,\ol{D}\,\ol{\tau}>a\left(\Delta t\right)^{2}+b\,\Delta t+c\\
    &\implies a\left(\Delta t\right)^{2}+b\,\Delta t+c'<0,
\end{align}
where:
\begin{equation}
  c'=c-\ol{D}^{2}-\ol{\tau}^{2}-2\,\ol{D}\,\ol{\tau}=\ol{S}_{1}\,\ol{S}^{1}-\ol{\tau}^{2}-2\,\ol{D}\,\ol{\tau}.
\end{equation}

This time we want to make sure that our function has at least one real root. We still have that $a>0$, so now we check if $b^{2}-4\,a\,c'>0$:
\begin{equation}
    b^{2}-4\,a\,c'=\f{4\left(\ol{S}_{1}\right)^{2}}{\ol{\gamma_{11}}}a-4\,a\left(\ol{S}_{1}\,\ol{S}^{1}-\ol{\tau}^{2}-2\,\ol{D}\,\ol{\tau}\right)=4\,a\,\ol{\tau}\left(\ol{\tau}+2\,\ol{D}\right).
\end{equation}
Since $\ol{\tau}\geq0$, we must have that $\ol{\tau}>-2\,\ol{D}$. But, from condition two for $\ol{\bH}_{2}$ we have that $\ol{\tau}>-\ol{D}$, so this condition is automatically satisfied.

The solutions to this quadratic equation are:
\begin{align}
    \Delta t&=\f{-b}{2\,a}\pm\f{1}{2\,a}\sqrt{b^{2}-4\,a\,c'}=\f{-\ol{S}_{1}}{\sqrt{\ol{\gamma_{11}}}\,\sqrt{a}}\pm\f{1}{2\,a}\sqrt{\f{4\ol{S}_{1}^{2}}{\ol{\gamma_{11}}}a-4\,a\,c'}\\
    &=\f{-\ol{S}_{1}}{\sqrt{\ol{\gamma_{11}}}\,\sqrt{a}}\pm\f{1}{\sqrt{\ol{\gamma_{11}}}\,\sqrt{a}}\sqrt{\ol{S}_{1}^{2}-c'\,\ol{\gamma_{11}}}=\f{1}{\sqrt{\ol{\gamma_{11}}}\,\sqrt{a}}\left[-\ol{S}_{1}\pm\sqrt{\ol{S}_{1}^{2}-c'\,\ol{\gamma_{11}}}\right]\\
    &=\f{1}{\sqrt{\ol{\gamma_{11}}}\,\sqrt{a}}\left[-\ol{S}_{1}\pm\sqrt{\ol{\gamma_{11}}\left(\ol{\tau}^{2}+2\,\ol{D}\,\ol{\tau}\right)}\right]\\
    &=\f{2\left(1-\ve\right)}{\ol{P^{kk}\,\p_{1}\,\gamma_{kk}}}\left[-\ol{S}_{1}\pm\sqrt{\ol{\gamma_{11}}\left(\ol{\tau}^{2}+2\,\ol{D}\,\ol{\tau}\right)}\right]\\
    &=\f{2\left(1-\ve\right)}{\ol{P^{kk}\,\p_{1}\,\gamma_{kk}}}\left[-\ol{S}_{1}\pm\sqrt{\ol{\gamma_{11}}\,\ol{\tau}\left(\ol{\tau}+2\,\ol{D}\right)}\right].
\end{align}

\section{Computing the Time-Step Using Higher-Order DG Schemes}

When making the jump to higher-order DG schemes, we can simply do the same as in the first-order scheme, except we compute the quantities in all of the nodal points instead of using a cell-average. This is valid because the cell-average is a convex combination...\sd{Need to expand on this}. The proof starts with the discretized equation valid at each quadrature point, $q$:
\begin{equation}
    \bU_{q}^{n+1}=\bU_{q}^{n}+\Delta t\,\cL_{q}^{n},
\end{equation}
where $\cL_{q}^{n}$ is a general form of the RHS at time $t^{n}$. If we define a vector $\ol{\bU}\equiv\left(\bU_{1},\cdots,\bU_{q},\cdots,\bU_{Q}\right)^T$, where $Q$ is the total number of quadrature points, and $\ol{\bW}\equiv\left(\bW_{1},\cdots,\bW_{q},\cdots,\bW_{Q}\right)^T$ as a vector of quadrature weights, then we can write the cell-average of $\bU$ as:
\begin{equation}
    \bU_{K}\equiv\ol{\bW}^T\ol{\bU}.
\end{equation}
If we then compute the cell-average of the above equation, we get:
\begin{equation}
    \bU_{K}^{n+1}=\bU_{K}^{n}+\Delta t\,\ol{\bW}^{T}\,\ol{\cL}_{q}^{n}=\ol{\bW}^{T}\left(\ol{\bU}^{n}+\Delta t\,\ol{\cL}^{n}\right)
\end{equation}

\newpage
\section{Recovery of Primitive Variables}
In order to recover the primitive from the conserved variables we need to solve the nonlinear equation:
\begin{equation}
    f\left(p\right)=p-\ol{p}\left(p\right)=0,
\end{equation}
where $\ol{p}\left(p\right)$ is the pressure as obtained via the ideal gas equation of state with an initial guess, $p$:
\begin{equation}
    \ol{p}=\left(\Gamma-1\right)\rho\,\epsilon,
\end{equation}
where
\begin{equation}
    \rho=\rho\left(\bU,p\right),\hspace{1em}\epsilon=\epsilon\left(\bU,p\right).
\end{equation}

In order to solve this equation we make use of the bisection method, and therefore need bounds on our initial guess for the pressure.

\subsection{Upper and Lower Bounds for Pressure}
We obtain a lower bound for the pressure with:
\begin{equation}
\tau=D\left(h\,W-1\right)-p\implies p=-\left(\tau+D\right)+D\,h\,W\geq-\left(\tau+D\right)+D\,h\,W\,\sqrt{v^{i}\,v_{i}}=-\left(\tau+D\right)+\sqrt{S^{i}\,S_{i}}.
\end{equation}
So, since the pressure must be non-negative, we have:
\begin{equation}
p\geq\text{MAX}\left[-\left(\tau+D\right)+\sqrt{S^{i}\,S_{i}},\text{SqrtTiny}\right].
\end{equation}

For an upper bound, we first note that:
\begin{equation}
h=1+\f{e+p}{\rho}=1+\f{\Gamma}{\Gamma-1}\f{p}{\rho}=1+\f{\Gamma}{\Gamma-1}\,\f{p\,W}{D},
\end{equation}
so,
\begin{equation}
\tau=D\left(W+\f{\Gamma}{\Gamma-1}\f{p\,W^{2}}{D}-1\right)-p=D\left(W-1\right)+p\left(\f{\Gamma}{\Gamma-1}W^{2}-1\right).
\end{equation}
So,
\begin{equation}
p=\f{\tau-D\left(W-1\right)}{\f{\Gamma}{\Gamma-1}W^{2}-1}.
\end{equation}
We also have:
\begin{equation}
W=\left(1-v^{i}\,v_{i}\right)^{-1/2}=\left(1-\f{S^{i}\,S_{i}}{\left(\tau+D+p\right)^{2}}\right)^{-1/2}.
\end{equation}
Treating $p$ as an independent variable \sd{is this valid?}, we have:
\begin{equation}
W\Big|_{p\rightarrow\infty}=1,
\end{equation}
which gives us an upper limit:
\begin{equation}
p\leq\f{\Gamma-1}{\Gamma}\,\tau.
\end{equation}
Just to be safe, in the code we multiply this by two, so that:
\begin{equation}
p\leq2\,\f{\Gamma-1}{\Gamma}\,\tau.
\end{equation}

\newpage





\bibliographystyle{apj}
\bibliography{../References/references.bib}

\end{document}